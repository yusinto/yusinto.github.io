{"componentChunkName":"component---src-pages-post-template-js","path":"/build-graphql-schema-without-babelrc","result":{"data":{"site":{"siteMetadata":{"blurb":"Frontend Engineer @ LaunchDarkly. Book addict and tea lover. Passionate about react graphql and making things simple and fast."}},"markdownRemark":{"html":"<p>Man it has been a busy month! It's been a while since I blogged, I have to say I miss it a lot. Almost as much as I\nmiss drinking.. </p>\n<p>Today I'll be talking about graphql and relay, specifically about building the schema. Warning this is not a beginner's\nguide to graphql and relay, there are tons of other tutorials which can help you with that. This blog is about\ndecoupling your graphql schema build from your project's .babelrc file.</p>\n<h2 id=\"the-problem\"><a href=\"#the-problem\" aria-label=\"the problem permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The problem</h2>\n<p>Your project has a .babelrc file which contains presets, plugins, etc used by babel when you run your app. You need\nto include babelRelayPlugin in your .babelrc plugins section so your relay app can comprehend your graphql schema.</p>\n<p>However, babelRelayPlugin.js contains a reference to schema.json which is generated by babel-node <a href=\"https://github.com/relayjs/relay-starter-kit/blob/master/scripts/updateSchema.js\" target=\"_blank\" rel=\"nofollow\">updateSchema.js</a>\nwhich in turn uses .babelrc which has a dependency on babelRelayPlugin which is a cyclic dependency which gives me a\nmigraine.</p>\n<h2 id=\"the-solution\"><a href=\"#the-solution\" aria-label=\"the solution permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The solution</h2>\n<p>We need to decouple graphql schema generation from app runtime. The standard .babelrc file is required for our app runtime so that stays.\nThat means we cannot depend on .babelrc for our schema generation i.e. when running <a href=\"https://github.com/relayjs/relay-starter-kit/blob/master/scripts/updateSchema.js\" target=\"_blank\" rel=\"nofollow\">updateSchema.js</a>\nwe can't use babel-node. Instead we use plain vanilla node in combination with babel-register with inline\nconfig when running updateSchema.</p>\n<h2 id=\"enough-talk-show-me-some-code\"><a href=\"#enough-talk-show-me-some-code\" aria-label=\"enough talk show me some code permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Enough talk, show me some code</h2>\n<p>You need the following babel packages:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">yarn</span> <span class=\"token function\">add</span> --dev babel-polyfill babel-preset-latest\n<span class=\"token function\">sudo</span> <span class=\"token function\">yarn</span> <span class=\"token function\">add</span> babel-register babel-preset-stage-0</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>In your package.json, you declare an npm run command update-schema which points an index.js file:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-json line-numbers\"><code class=\"language-json\"><span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"update-schema\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"node ./src/graphql/index.js\"</span><span class=\"token punctuation\">,</span>\n    ...\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Your src/graphql/index.js then looks like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'babel-register'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  babelrc<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n  presets<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"latest\"</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"babel-polyfill\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// required for async generators</span>\n<span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./updateSchema'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>where updateSchema.js is provided by facebook <a href=\"https://github.com/relayjs/relay-starter-kit/blob/master/scripts/updateSchema.js\" target=\"_blank\" rel=\"nofollow\">here</a>.</p>\n<h2 id=\"conclusion\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>Check out the <a href=\"https://github.com/yusinto/movie-time\" target=\"_blank\" rel=\"nofollow\">sample code</a> for a working example and let me know if this is useful (or not)!</p>\n<hr>","timeToRead":2,"frontmatter":{"date":"December 12, 2016","path":"/build-graphql-schema-without-babelrc","title":"Building graphql schema without babelrc","files":null,"tags":["graphql","schema","relay","react","babel","babelrc","build","babelrelayplugin"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false}}}
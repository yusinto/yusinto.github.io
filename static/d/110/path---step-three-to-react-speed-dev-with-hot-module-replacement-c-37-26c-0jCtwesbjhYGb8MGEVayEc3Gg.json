{"data":{"site":{"siteMetadata":{"blurb":"Frontend Engineer @ LaunchDarkly. Book addict and tea lover. Passionate about react graphql and making things fast."}},"markdownRemark":{"html":"<p>In the <a href=\"/step-two-to-react-webpack-and-react/\">previous post</a> we started writing react code\nand that was cool. However having to restart the app and refresh the browser everytime we make a change is a pain.\nThere must be a better way to optimise our dev/debug cycle.</p>\n<p>And yes there is. Enter react hot module replacement or hmr created by <a href=\"https://github.com/gaearon\" target=\"_blank\" rel=\"nofollow\">Dan Abramov</a> the creator of redux. Hmr is a much much better\n\"version\" of liveReload. You don't need to inject a script tag into your code and there is no browser refresh. When you make\nchanges to your code, they simply appear in the browser like magic without reload.</p>\n<p>This is a short post just to get hmr working so let's dive straight into the code now and I'll explain things along the way.</p>\n<hr>\n<h2 id=\"step-31-install-transforms-and-webpack-middlewares\"><a href=\"#step-31-install-transforms-and-webpack-middlewares\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Step 3.1: Install transforms and webpack middlewares</h2>\n<p>There are 6 packages we need to install:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev babel-plugin-react-transform react-transform-hmr react-transform-catch-errors redbox-react webpack-dev-middleware webpack-hot-middleware</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p><strong>babel-plugin-react-transform</strong> - This modifies your react components by applying all the transforms we configure in .babelrc.</p>\n<p><strong>react-transform-hmr</strong> - This transform enables hot reloading of components</p>\n<p><strong>react-transform-catch-errors</strong> - This transform catches errors inside the render() method and renders that error instead of your component.</p>\n<p><strong>redbox-react</strong> - Used by react-transform-catch-errors to display errors in a red screen of death in the browser.</p>\n<p><strong>webpack-dev-middleware</strong> - bundles our js file on the fly, stores it in memory and serves it</p>\n<p><strong>webpack-hot-middleware</strong> - enables hot reloading using webpack-dev-middleware above</p>\n<hr>\n<h2 id=\"step-32-configure-babel\"><a href=\"#step-32-configure-babel\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Step 3.2: Configure babel</h2>\n<p>Your .babelrc file should look like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-json line-numbers\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"presets\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"es2015\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"plugins\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">[</span><span class=\"token string\">\"react-transform\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"transforms\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n                <span class=\"token property\">\"transform\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"react-transform-hmr\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token property\">\"imports\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"react\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                <span class=\"token property\">\"locals\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"module\"</span><span class=\"token punctuation\">]</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token property\">\"transform\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"react-transform-catch-errors\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token property\">\"imports\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"react\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"redbox-react\"</span><span class=\"token punctuation\">]</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>This is the configuration that uses the transform packages above. In short, we instruct the\nreact-transform plugin to apply 2 transforms: the hmr and catch-errors transforms to our react\ncomponents. In simple terms, transforms are just functions that accepts a react component as input and modifies it. For\nexample, <strong><em>react-transform-catch-errors</em></strong> adds a try catch block on the original render method to catch exceptions.</p>\n<hr>\n<h2 id=\"step-33-configure-webpack\"><a href=\"#step-33-configure-webpack\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Step 3.3: Configure webpack</h2>\n<p>Your webpack.config.dev.js should look like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> webpack <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'webpack'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Add webpack-hot-middleware/client to our bundle so our app </span>\n    <span class=\"token comment\">// subscribes to update notifications from the server</span>\n    entry<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'webpack-hot-middleware/client'</span><span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'src/client/index'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    output<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        path<span class=\"token punctuation\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'dist'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        filename<span class=\"token punctuation\">:</span> <span class=\"token string\">'bundle.js'</span><span class=\"token punctuation\">,</span>\n        \n        <span class=\"token comment\">// Add a publicPath property. This is the path referenced in the </span>\n        <span class=\"token comment\">// script tag in our html template to our bundle.js. We need </span>\n        <span class=\"token comment\">// this to configure webpack-dev-middleware in server.js</span>\n        publicPath<span class=\"token punctuation\">:</span> <span class=\"token string\">'/dist/'</span> \n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    module<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        loaders<span class=\"token punctuation\">:</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n            test<span class=\"token punctuation\">:</span> <span class=\"token regex\">/\\.jsx?$/</span><span class=\"token punctuation\">,</span>\n            loader<span class=\"token punctuation\">:</span> <span class=\"token string\">'babel'</span><span class=\"token punctuation\">,</span>\n            include<span class=\"token punctuation\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'src'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    \n    <span class=\"token comment\">// Enables hot module replacement in webpack</span>\n    plugins<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token keyword\">new</span> <span class=\"token class-name\">webpack<span class=\"token punctuation\">.</span>HotModuleReplacementPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<hr>\n<h2 id=\"step-34-modify-express-app-to-support-hmr\"><a href=\"#step-34-modify-express-app-to-support-hmr\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Step 3.4: Modify express app to support hmr</h2>\n<p>Almost there! Now we need to modify server.js to use webpack dev and hot middlewares.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// ...</span>\n\n<span class=\"token keyword\">import</span> Webpack <span class=\"token keyword\">from</span> <span class=\"token string\">'webpack'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> WebpackConfig <span class=\"token keyword\">from</span> <span class=\"token string\">'../../webpack.config.dev'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> WebpackDevMiddleware <span class=\"token keyword\">from</span> <span class=\"token string\">'webpack-dev-middleware'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> WebPackHotMiddleware <span class=\"token keyword\">from</span> <span class=\"token string\">'webpack-hot-middleware'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// ...</span>\n\n<span class=\"token comment\">// create a webpack instance from our dev config</span>\n<span class=\"token keyword\">const</span> webpackCompiler <span class=\"token operator\">=</span> <span class=\"token function\">Webpack</span><span class=\"token punctuation\">(</span>WebpackConfig<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Use webpack dev middleware to bundle our app on the fly and serve it </span>\n<span class=\"token comment\">// on publicPath. Turn off verbose webpack output in our server console</span>\n<span class=\"token comment\">// by setting noInfo: true</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token function\">WebpackDevMiddleware</span><span class=\"token punctuation\">(</span>webpackCompiler<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    publicPath<span class=\"token punctuation\">:</span> WebpackConfig<span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span>publicPath<span class=\"token punctuation\">,</span>\n    noInfo<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// instruct our webpack instance to use webpack hot middleware</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token function\">WebPackHotMiddleware</span><span class=\"token punctuation\">(</span>webpackCompiler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// NOTE: delete express static middleware for dist. We don't need that</span>\n<span class=\"token comment\">// anymore because webpack-dev-middleware serves our bundle.js from memory</span>\n\n<span class=\"token comment\">// ...</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<hr>\n<h2 id=\"step-35-run-the-app\"><a href=\"#step-35-run-the-app\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Step 3.5: Run the app!</h2>\n<p>If you have been following my <a href=\"/step-two-to-react-webpack-and-react/\">previous post</a> up to this point,\nnote that you'll need to delete the prestart command from package.json. We don't need that anymore because we are using webpack\ndev middleware to bundle our app on the fly. </p>\n<p>If you have the physical /dist/ folder, also delete that because\nagain webpack dev middleware will serve bundle.js from memory.</p>\n<p>At your root directory run \"npm start\" and browse to localhost:3000. Then make changes to appComponent.js; maybe change\nthe h1 text. You'll see your changes in the browser immediately without refresh.</p>\n<p>Download the complete source code from <a href=\"https://github.com/yusinto/reactStep3\" target=\"_blank\" rel=\"nofollow\">github</a>.</p>\n<hr>","timeToRead":3,"frontmatter":{"date":"April 02, 2016","path":"/step-three-to-react-speed-dev-with-hot-module-replacement","title":"Step 3 to React - Speed dev with hot module replacement","files":null,"tags":["react","hmr","hot","module","replacement","webpack","babel"]}}},"pageContext":{}}